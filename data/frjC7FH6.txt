<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><p>public function rating(){
        $postRatings = PostRatingCache::getInstance();
        $data = $postRatings-&gt;getPostRatingsByPostID(intval($this-&gt;parameters['postID']));
        if(isset($data["user"]) &amp;&amp; isset($data["user"][WCF::getUser()-&gt;userID])){
            $sql = 'DELETE FROM wbb'.WCF_N.'_post_rating_to_post WHERE postID = ? AND userID = ?';
            $statement = WCF::getDB()-&gt;prepareStatement($sql);
            $statement-&gt;execute(array(intval($this-&gt;parameters['postID']),
                                      WCF::getUser()-&gt;userID));
        }
 		if (!(isset($data["user"]) &amp;&amp; isset($data["user"][WCF::getUser()-&gt;userID]) &amp;&amp; isset($data["user"][WCF::getUser()-&gt;userID][$this-&gt;objectIDs[0]]))){
 	 		$sql = 'INSERT INTO wbb'.WCF_N.'_post_rating_to_post VALUES (?, ?, ?) ';
            $statement = WCF::getDB()-&gt;prepareStatement($sql);
            $statement-&gt;execute(array($this-&gt;objectIDs[0], intval($this-&gt;parameters['postID']),
                                      WCF::getUser()-&gt;userID));
 		}

 		PostRatingCacheBuilder::getInstance()-&gt;reset();

 		$ratings_new = '';
 		$post = new \wbb\data\post\Post($this-&gt;parameters['postID']);
 		$postRatings = PostRatingCache::getInstance();
        $data = $postRatings-&gt;getPostRatingsByPostID(intval($this-&gt;parameters['postID']));

        foreach($postRatings-&gt;getPostRatings() as $postRating){
            $ratings_new .= '
                <span class="postRating jsTooltip pointer" title="' . $postRating-&gt;getTitle() . '" data-user-id="' . $post-&gt;userID . '" data-post-id="' . $post-&gt;postID . '" data-object-id="' . $postRating-&gt;ratingID . '">
                    <img src="'%20.%20%24postRating-&gt;getPreviewImage()%20.%20'" style="width: 16px; height: 16px">
                    <sub>x' . $postRatings-&gt;getPostRatingsRatingCount($post-&gt;postID, $postRating-&gt;ratingID) . '</sub>
                </span>
            ';
        }
 
        return array('ratings_new' =&gt; $ratings_new, 'post_id' =&gt; $post-&gt;postID);
    }</p></body></html>
